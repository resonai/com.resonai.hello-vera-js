import{j as n}from"./jseApiHelper-dd9c2ac4.js";const p="iotScene";let s,c,d,h;async function y(){n.loaded(),s=await n.getAppConfig(),d=s.Provider.Url,h=s.Provider.Authorization;const e=s.Devices;if(!e)return;const t=await S();await n.initScene({sceneID:p}),e.forEach(async o=>{const a=o.ID,i=t[a],r=o.Device,f=[1,1,1],g=l({isOn:i}),m=await n.getSOCenter({key:r.key});c={sceneID:p,id:a,position:m,scale:f,gltf:g,onEvent:({id:v,event:w})=>{w=="mouseUp"&&u({id:v,isOn:i})}},n.mesh(c)})}y();async function S(){try{const t=await(await fetch(`${d}/api/devices`,{method:"get",headers:{authorization:h}})).json();return Object.fromEntries(t.map(o=>[o.id,o.isOn]))}catch(e){console.error("getDevices: error",e)}}async function u({id:e,isOn:t}){try{t=(await(await fetch(`${d}/api/devices/${e}/action/turn${t?"Off":"On"}`,{method:"post",headers:{authorization:h}})).json()).isOn;const i=l({isOn:t});c={sceneID:p,id:e,gltf:i,onEvent:({id:r,event:f})=>{f=="mouseUp"&&u({id:r,isOn:t})}},n.mesh(c)}catch(o){console.error("switchLight: error",o)}}function l({isOn:e}){return`https://storage.googleapis.com/resonai-public/com.resonai.iot/models/bulb-${e?"on":"off"}.glb`}
